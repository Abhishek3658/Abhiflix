<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Abhiflix â€” Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(4px);
    }
    .card-hover {
      transition: transform .22s ease, box-shadow .22s ease;
    }
    .card-hover:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 30px rgba(2,6,23,0.6);
    }
    body.modal-open { overflow:hidden; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

  <!-- Header -->
  <header class="bg-gradient-to-r from-slate-900 via-gray-900 to-black sticky top-0 z-40 shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4 py-4">
        <div class="flex items-center gap-4 w-full md:w-auto">
          <h1 class="text-2xl sm:text-3xl font-extrabold text-teal-400">ðŸŽ¬ Abhiflix Pro</h1>
          <div class="hidden sm:flex items-center gap-2 ml-2">
            <button onclick="openWatchlist()" class="px-3 py-1 rounded-md bg-slate-800 hover:bg-slate-700 text-sm">My Watchlist (<span id="watchlistCount">0</span>)</button>
            <button id="darkToggle" class="px-3 py-1 rounded-md bg-slate-800 hover:bg-slate-700 text-sm">ðŸŒ™</button>
          </div>
        </div>

        <div class="w-full md:w-2/5">
          <div class="flex w-full gap-2">
            <input id="searchInput" type="search" placeholder="Search movies..." class="w-full px-4 py-2 rounded-md text-gray-900 focus:outline-none" />
            <button id="searchBtn" class="px-4 py-2 rounded-md bg-teal-500 hover:bg-teal-600">Search</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h2 id="sectionTitle" class="text-2xl font-bold mb-4">ðŸ”¥ Trending Movies</h2>
    <div id="moviesWrapper" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
    <div class="flex justify-center mt-6">
      <button id="loadMoreBtn" class="px-6 py-2 rounded-md bg-slate-800 hover:bg-slate-700">Load more</button>
    </div>
  </main>

  <!-- Details Modal -->
  <div id="detailsModal" class="hidden fixed inset-0 z-50 flex items-start justify-center py-10 px-4 overflow-y-auto">
    <div id="detailsBackdrop" class="absolute inset-0 bg-black/70"></div>
    <div class="relative w-full max-w-5xl bg-slate-900 rounded-xl glass overflow-hidden shadow-2xl z-60 p-6">
      <div class="flex flex-col lg:flex-row gap-6">
        <img id="detailPoster" class="w-64 h-96 object-cover rounded-md" alt="">
        <div>
          <h3 id="detailTitle" class="text-2xl font-extrabold"></h3>
          <p id="overview" class="mt-3 text-gray-300"></p>
          <div class="mt-4 flex gap-3">
            <button id="watchBtn" class="px-3 py-2 bg-teal-500 rounded-md">â–¶ Watch</button>
            <button id="addWatchlistBtn" class="px-3 py-2 bg-slate-800 rounded-md">+ Watchlist</button>
            <button onclick="closeDetails()" class="px-3 py-2 bg-red-600 rounded-md">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  const API_KEY = "3207763a6b035e30d529f20b85bcccb4"; // âœ… TMDB key
  const BASE = "https://api.themoviedb.org/3";
  const IMAGE_BASE = "https://image.tmdb.org/t/p/w500";

  let page = 1;
  let currentCategory = "trending";
  let currentQuery = "";

  function el(s){return document.querySelector(s)}

  document.addEventListener("DOMContentLoaded", () => {
    attachUI();
    loadMovies(true);
  });

  function attachUI(){
    el("#searchBtn").onclick = ()=>{ page=1; searchMovies(); }
    el("#searchInput").onkeydown = e=>{ if(e.key==="Enter"){ page=1; searchMovies(); } }
    el("#loadMoreBtn").onclick = ()=>{ page++; loadMovies(); }
    el("#darkToggle").onclick = toggleDark;
  }

  function toggleDark(){
    document.body.classList.toggle("bg-gray-900");
    document.body.classList.toggle("bg-white");
    document.body.classList.toggle("text-white");
    document.body.classList.toggle("text-black");
  }

  async function loadMovies(reset=false){
    const url = currentQuery
      ? `${BASE}/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(currentQuery)}&page=${page}`
      : `${BASE}/trending/movie/week?api_key=${API_KEY}&page=${page}`;
    const res = await fetch(url);
    const data = await res.json();
    const movies = data.results || [];
    renderMovies(movies, reset);
  }

  function renderMovies(movies, reset){
    const wrap = el("#moviesWrapper");
    if(reset) wrap.innerHTML="";
    wrap.insertAdjacentHTML("beforeend", movies.map(m=>{
      const poster = m.poster_path ? IMAGE_BASE+m.poster_path : "https://via.placeholder.com/300x450?text=No+Image";
      return `
        <div onclick="openDetails(${m.id})" class="bg-slate-800 rounded-md overflow-hidden card-hover cursor-pointer">
          <img src="${poster}" class="w-full h-72 object-cover" />
          <div class="p-3">
            <h3 class="font-semibold text-sm">${m.title}</h3>
            <p class="text-xs text-gray-400 mt-1">${m.release_date||""}</p>
          </div>
        </div>`;
    }).join(""));
  }

  async function openDetails(id){
    const res = await fetch(`${BASE}/movie/${id}?api_key=${API_KEY}&language=en-US`);
    const data = await res.json();
    el("#detailPoster").src = data.poster_path ? IMAGE_BASE+data.poster_path : "";
    el("#detailTitle").innerText = data.title;
    el("#overview").innerText = data.overview;
    el("#watchBtn").onclick = ()=>window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(data.title+" trailer")}`,"_blank");
    show(el("#detailsModal"));
  }

  function closeDetails(){ hide(el("#detailsModal")); }

  function show(e){ e.classList.remove("hidden"); document.body.classList.add("modal-open"); }
  function hide(e){ e.classList.add("hidden"); document.body.classList.remove("modal-open"); }

  function searchMovies(){
    currentQuery = el("#searchInput").value.trim();
    loadMovies(true);
  }
  </script>
</body>
</html>
